{% extends "base.html" %}
{% block title %}ëŒ€ì‹œë³´ë“œ{% endblock %}
{% block content %}
<h2>ëŒ€ì‹œë³´ë“œ</h2>
<form method="get" action="{{ url_for('search') }}">
  <input type="text" name="q" placeholder="ìƒí’ˆëª… ê²€ìƒ‰" value="{{ query or '' }}">
  <button type="submit">ê²€ìƒ‰</button>
</form>

<h3>ë“±ë¡ëœ ìƒí’ˆ</h3>
<ul>
  {% for product in products %}
    <li>
      <a href="{{ url_for('view_product', product_id=product.id) }}">
        {{ product.title }} - {{ product.price }}ì›
      </a>
    </li>
  {% else %}
    <li>ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</li>
  {% endfor %}
</ul>

<p><a href="{{ url_for('new_product') }}">â• ìƒˆ ìƒí’ˆ ë“±ë¡</a></p>

<hr>

<h3>ì‹¤ì‹œê°„ ì „ì²´ ì±„íŒ…</h3>
<h3>ğŸ’¬ ì „ì²´ ì±„íŒ… ê¸°ë¡</h3>
<ul id="global_chat_log">
  {% for log in chat_logs %}
    <li><strong>{{ log.username }}</strong> ({{ log.timestamp }}): {{ log.message }}</li>
  {% endfor %}
</ul>
<div id="chat">
  <ul id="messages"></ul>
  <input id="chat_input" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
  <button onclick="sendMessage()">ì „ì†¡</button>
</div>

<script type="text/javascript">
  const socket = io();
  socket.on('connect', () => {
    console.log("ì±„íŒ… ì„œë²„ì— ì—°ê²°ë¨");
  });
  socket.on('message', (data) => {
    const messages = document.getElementById('messages');
    const item = document.createElement('li');
    item.textContent = data.username + ": " + data.message;
    messages.appendChild(item);
    messages.scrollTop = messages.scrollHeight;
  });

  function sendMessage() {
    const input = document.getElementById('chat_input');
    const message = input.value;
    if (message.trim() !== "") {
      socket.emit('send_message', {
        username: "{{ user.username }}",
        message: message
      });
      input.value = "";
    }
  }
</script>
{% endblock %}
