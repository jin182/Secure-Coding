{% extends "base.html" %}
{% block title %}ê´€ë¦¬ì í˜ì´ì§€{% endblock %}
{% block content %}
<h2>ğŸ“ˆ ê´€ë¦¬ì í˜ì´ì§€</h2>

<!-- íƒ­ ë²„íŠ¼ ë©”ë‰´ -->
<div>
  <button onclick="showTab('tab_users')">ì‚¬ìš©ì ê´€ë¦¬</button>
  <button onclick="showTab('tab_products')">ìƒí’ˆ ê´€ë¦¬</button>
  <button onclick="showTab('tab_reports')">ì‹ ê³  í™•ì¸</button>
</div>

<hr>

<!-- ì‚¬ìš©ì ê´€ë¦¬ íƒ­ -->
<div id="tab_users" class="admin-tab" style="display:none">
  <h3>ì „ì²´ ì‚¬ìš©ì ëª©ë¡</h3>
  <ul>
    {% for user in all_users %}
      <li>
        <strong>{{ user.username }}</strong> | íœ´ë¨¼: {{ 'O' if not user.is_active else 'X' }} | ë°°ë‹¬: {{ user.balance }}
        {% if user.is_active %}
          <form method="post" action="{{ url_for('admin_block_user', user_id=user.id) }}" style="display:inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit">íœ´ë¨¼í™”</button>
          </form>
        {% else %}
          <form method="post" action="{{ url_for('admin_unblock_user', user_id=user.id) }}" style="display:inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit">íœ´ë¨¼ í•´ì œ</button>
          </form>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</div>

<!-- ìƒí’ˆ ê´€ë¦¬ íƒ­ -->
<div id="tab_products" class="admin-tab" style="display:none">
  <h3>ì „ì²´ ìƒí’ˆ ëª©ë¡</h3>
  <ul>
    {% for product in all_products %}
      <li>
        <strong>{{ product.title }}</strong> | ê°€ê²©: {{ product.price }} | íŒë§¤: {% if product.is_sold %}ê±´{% else %}ì¤‘{% endif %} | ì°¨ë‹¨: {{ product.is_blocked }}
        {% if product.is_blocked %}
          <form method="post" action="{{ url_for('admin_unblock_product', product_id=product.id) }}" style="display:inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit">ì°¨ë‹¨ í•´ì œ</button>
          </form>
        {% else %}
          <form method="post" action="{{ url_for('admin_block_product', product_id=product.id) }}" style="display:inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit">ì°¨ë‹¨</button>
          </form>
        {% endif %}
        <form method="post" action="{{ url_for('admin_delete_product', product_id=product.id) }}" style="display:inline">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button type="submit">ì‚­ì œ</button>
        </form>
      </li>
    {% endfor %}
  </ul>
</div>

<!-- ì‹ ê³  í™•ì¸ íƒ­ -->
<div id="tab_reports" class="admin-tab">
  <h3>ì‹ ê³  ë°›ì€ ì‚¬ìš©ì</h3>
  <ul>
    {% for user in reported_users %}
      <li>
        <strong>{{ user.username }}</strong> â€” ì‹ ê³  {{ user.report_count }}íšŒ
        {% if user.is_active %}
          <form method="post" action="{{ url_for('admin_block_user', user_id=user.id) }}" style="display:inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit">íœ´ë¨¼í™”</button>
          </form>
        {% else %}
          <form method="post" action="{{ url_for('admin_unblock_user', user_id=user.id) }}" style="display:inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit">íœ´ë¨¼ í•´ì œ</button>
          </form>
        {% endif %}
      </li>
    {% endfor %}
  </ul>

  <h3>ì‹ ê³  ë°›ì€ ìƒí’ˆ</h3>
  <ul>
    {% for product in reported_products %}
      <li>
        <strong>{{ product.title }}</strong> â€” ì‹ ê³  {{ product.report_count }}íšŒ
        {% if product.is_blocked %}
          <form method="post" action="{{ url_for('admin_unblock_product', product_id=product.id) }}" style="display:inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit">ì°¨ë‹¨ í•´ì œ</button>
          </form>
        {% else %}
          <form method="post" action="{{ url_for('admin_block_product', product_id=product.id) }}" style="display:inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit">ì°¨ë‹¨</button>
          </form>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</div>

<script>
  function showTab(tabId) {
    document.querySelectorAll('.admin-tab').forEach(t => t.style.display = 'none');
    document.getElementById(tabId).style.display = 'block';
  }
  showTab('tab_reports'); // ê¸°ë³¸ íƒ­
</script>
{% endblock %}
